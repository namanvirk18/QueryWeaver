{# Left vertical toolbar to host expandable buttons (keeps future buttons easy to add) #}
<nav id="left-toolbar" aria-label="Left toolbar" role="toolbar" aria-orientation="vertical">
    <div id="left-toolbar-inner">
        <!-- Toolbar buttons container -->
        <div id="toolbar-buttons">
            <button id="burger-toggle-btn" class="action-button toolbar-button" title="Open menu" aria-label="Open menu">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="3" y="6" width="18" height="2" rx="1" fill="currentColor" />
                    <rect x="3" y="11" width="18" height="2" rx="1" fill="currentColor" />
                    <rect x="3" y="16" width="18" height="2" rx="1" fill="currentColor" />
                </svg>
            </button>

            <!-- Theme toggle moved here from the top toolbar -->
            <button id="theme-toggle-btn" class="action-button toolbar-button" title="Toggle Theme"
                aria-label="Toggle theme" aria-pressed="false" tabindex="-1">
                <svg class="theme-icon" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle class="sun" cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" />
                    <path class="sun"
                        d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"
                        stroke="currentColor" stroke-width="2" />
                    <path class="moon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor"
                        stroke-width="2" fill="currentColor" />
                    <defs>
                        <clipPath id="leftHalf">
                            <rect x="0" y="0" width="12" height="24" />
                        </clipPath>
                        <clipPath id="rightHalf">
                            <rect x="12" y="0" width="12" height="24" />
                        </clipPath>
                    </defs>
                    <circle class="system" cx="12" cy="12" r="8" fill="currentColor" clip-path="url(#leftHalf)" />
                    <circle class="system" cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2"
                        clip-path="url(#rightHalf)" />
                    <circle class="system" cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2" />
                </svg>
            </button>
            <button class="action-button toolbar-button" id="menu-button" title="Instructions" aria-label="Instructions"
                aria-pressed="false" tabindex="0">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-sliders-horizontal-icon lucide-sliders-horizontal">
                    <line x1="21" x2="14" y1="4" y2="4" />
                    <line x1="10" x2="3" y1="4" y2="4" />
                    <line x1="21" x2="12" y1="12" y2="12" />
                    <line x1="8" x2="3" y1="12" y2="12" />
                    <line x1="21" x2="16" y1="20" y2="20" />
                    <line x1="12" x2="3" y1="20" y2="20" />
                    <line x1="14" x2="14" y1="2" y2="6" />
                    <line x1="8" x2="8" y1="10" y2="14" />
                    <line x1="16" x2="16" y1="18" y2="22" />
                </svg>
            </button>
            <!-- Schema button (replaces analytics) -->
            <button class="action-button toolbar-button" id="schema-button" title="Schema" aria-label="Open schema"
                aria-pressed="false" tabindex="-1">
                <!-- Simple database/schema icon: cylinder + table nodes -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-waypoints-icon lucide-waypoints">
                    <circle cx="12" cy="4.5" r="2.5" />
                    <path d="m10.2 6.3-3.9 3.9" />
                    <circle cx="4.5" cy="12" r="2.5" />
                    <path d="M7 12h10" />
                    <circle cx="19.5" cy="12" r="2.5" />
                    <path d="m13.8 17.7 3.9-3.9" />
                    <circle cx="12" cy="19.5" r="2.5" />
                </svg>
            </button>
        </div>
    </div>
    <div id="left-toolbar-footer"></div>
</nav>

<script>
// Left toolbar open/close behavior
(function () {
    const nav = document.getElementById('left-toolbar');
    const btn = document.getElementById('burger-toggle-btn');
    if (!nav || !btn) return;

    // Utility to set open/closed state. We toggle a "collapsed" class and update ARIA/title attributes.
    function setOpen(open) {
        if (open) {
            nav.classList.remove('collapsed');
            document.body.classList.add('left-toolbar-open');
            btn.setAttribute('title', 'Close menu');
            btn.setAttribute('aria-label', 'Close menu');
            btn.setAttribute('aria-pressed', 'true');
            btn.setAttribute('aria-expanded', 'true');
        } else {
            nav.classList.add('collapsed');
            document.body.classList.remove('left-toolbar-open');
            btn.setAttribute('title', 'Open menu');
            btn.setAttribute('aria-label', 'Open menu');
            btn.setAttribute('aria-pressed', 'false');
            btn.setAttribute('aria-expanded', 'false');
        }
    }

    // Media query: desktop when >= 768px (adjust if your breakpoints differ)
    const mq = window.matchMedia('(min-width: 768px)');

    // Initialize based on media query: desktop -> open, mobile -> closed
    try {
        setOpen(mq.matches);
    } catch (e) {
        // fail-safe: keep open
        setOpen(true);
    }

    // Listen for viewport changes and update default state accordingly
    if (typeof mq.addEventListener === 'function') {
        mq.addEventListener('change', (ev) => setOpen(ev.matches));
    } else if (typeof mq.addListener === 'function') {
        mq.addListener((ev) => setOpen(ev.matches));
    }

    // Toggle on burger button click. Use pointerdown for reliable mobile/touch handling
    let ignoreNextClick = false;
    function handleToggleEvent() {
        const isCollapsed = nav.classList.contains('collapsed');
        setOpen(isCollapsed);
    }

    btn.addEventListener('pointerdown', function (e) {
        // Prevent unwanted focus/ghost clicks and handle touch/pen/mouse uniformly
        e.preventDefault();
        handleToggleEvent();
        // ignore the following 'click' event which may also fire
        ignoreNextClick = true;
    });

    btn.addEventListener('click', function (e) {
        if (ignoreNextClick) {
            // consume the synthetic click after pointerdown
            ignoreNextClick = false;
            return;
        }
        handleToggleEvent();
    });

    // Expose a minimal API for other scripts if needed
    window.__leftToolbar = {
        open: () => setOpen(true),
        close: () => setOpen(false),
        toggle: () => setOpen(!nav.classList.contains('collapsed'))
    };
})();
</script>